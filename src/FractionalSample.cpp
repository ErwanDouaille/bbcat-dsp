
#include <math.h>

#define BBCDEBUG_LEVEL 2
#include <bbcat-base/misc.h>

#include "FractionalSample.h"

BBC_AUDIOTOOLBOX_START

enum
{
  OversamplingRate = 128,
  FilterTaps       = 14,
};

static const double filter[OversamplingRate * FilterTaps] =
{
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  -7.152557373047e-007, -1.311302185059e-006, -1.907348632813e-006, -2.503395080566e-006, -3.218650817871e-006, -4.053115844727e-006, -4.887580871582e-006, -5.841255187988e-006, 
  -6.794929504395e-006, -7.867813110352e-006, -9.059906005859e-006, -1.037120819092e-005, -1.168251037598e-005, -1.311302185059e-005, -1.466274261475e-005, -1.633167266846e-005, 
  -1.800060272217e-005, -1.990795135498e-005, -2.181529998779e-005, -2.384185791016e-005, -2.598762512207e-005, -2.825260162354e-005, -3.051757812500e-005, -3.302097320557e-005, 
  -3.564357757568e-005, -3.826618194580e-005, -4.112720489502e-005, -4.398822784424e-005, -4.708766937256e-005, -5.018711090088e-005, -5.352497100830e-005, -5.686283111572e-005, 
  -6.043910980225e-005, -6.401538848877e-005, -6.771087646484e-005, -7.164478302002e-005, -7.557868957520e-005, -7.975101470947e-005, -8.392333984375e-005, -8.821487426758e-005, 
  -9.262561798096e-005, -9.715557098389e-005, -1.018047332764e-004, -1.065731048584e-004, -1.114606857300e-004, -1.164674758911e-004, -1.214742660522e-004, -1.266002655029e-004, 
  -1.318454742432e-004, -1.372098922729e-004, -1.425743103027e-004, -1.480579376221e-004, -1.536607742310e-004, -1.592636108398e-004, -1.649856567383e-004, -1.707077026367e-004, 
  -1.765489578247e-004, -1.823902130127e-004, -1.882314682007e-004, -1.940727233887e-004, -2.000331878662e-004, -2.059936523438e-004, -2.118349075317e-004, -2.177953720093e-004, 
  -2.237558364868e-004, -2.295970916748e-004, -2.355575561523e-004, -2.412796020508e-004, -2.471208572388e-004, -2.528429031372e-004, -2.584457397461e-004, -2.640485763550e-004, 
  -2.694129943848e-004, -2.747774124146e-004, -2.800226211548e-004, -2.851486206055e-004, -2.900362014771e-004, -2.949237823486e-004, -2.994537353516e-004, -3.039836883545e-004, 
  -3.081560134888e-004, -3.122091293335e-004, -3.160238265991e-004, -3.196001052856e-004, -3.228187561035e-004, -3.257989883423e-004, -3.285408020020e-004, -3.310441970825e-004, 
  -3.330707550049e-004, -3.348588943481e-004, -3.362894058228e-004, -3.373622894287e-004, -3.379583358765e-004, -3.381967544556e-004, -3.380775451660e-004, -3.374814987183e-004, 
  -3.364086151123e-004, -3.348588943481e-004, -3.328323364258e-004, -3.303289413452e-004, -3.273487091064e-004, -3.236532211304e-004, -3.196001052856e-004, -3.148317337036e-004, 
  -3.095865249634e-004, -3.036260604858e-004, -2.970695495605e-004, -2.899169921875e-004, -2.821683883667e-004, -2.735853195190e-004, -2.644062042236e-004, -2.545118331909e-004, 
  -2.439022064209e-004, -2.325773239136e-004, -2.205371856689e-004, -2.076625823975e-004, -1.940727233887e-004, -1.796483993530e-004, -1.643896102905e-004, -1.484155654907e-004, 
  -1.314878463745e-004, -1.138448715210e-004, -9.524822235107e-005, -7.581710815430e-005, -5.555152893066e-005, -3.445148468018e-005, -1.239776611328e-005, 1.049041748047e-005, 
  3.433227539063e-005, 5.912780761719e-005, 8.475780487061e-005, 1.113414764404e-004, 1.388788223267e-004, 1.672506332397e-004, 1.965761184692e-004, 2.268552780151e-004, 
  2.580881118774e-004, 2.901554107666e-004, 3.231763839722e-004, 3.571510314941e-004, 3.920793533325e-004, 4.278421401978e-004, 4.645586013794e-004, 5.021095275879e-004, 
  5.406141281128e-004, 5.799531936646e-004, 6.201267242432e-004, 6.611347198486e-004, 7.030963897705e-004, 7.457733154297e-004, 7.892847061157e-004, 8.336305618286e-004, 
  8.786916732788e-004, 9.244680404663e-004, 9.710788726807e-004, 1.018285751343e-003, 1.066207885742e-003, 1.114845275879e-003, 1.164078712463e-003, 1.213788986206e-003, 
  1.264214515686e-003, 1.314997673035e-003, 1.366376876831e-003, 1.418232917786e-003, 1.470565795898e-003, 1.523137092590e-003, 1.576185226440e-003, 1.629471778870e-003, 
  1.682996749878e-003, 1.736760139465e-003, 1.790761947632e-003, 1.844763755798e-003, 1.899003982544e-003, 1.953125000000e-003, 2.007246017456e-003, 2.061247825623e-003, 
  2.115249633789e-003, 2.168893814087e-003, 2.222418785095e-003, 2.275586128235e-003, 2.328395843506e-003, 2.380728721619e-003, 2.432584762573e-003, 2.483844757080e-003, 
  2.534627914429e-003, 2.584576606750e-003, 2.633810043335e-003, 2.682209014893e-003, 2.729654312134e-003, 2.776265144348e-003, 2.821683883667e-003, 2.866148948669e-003, 
  2.909302711487e-003, 2.951145172119e-003, 2.991795539856e-003, 3.030896186829e-003, 3.068566322327e-003, 3.104686737061e-003, 3.139138221741e-003, 3.171801567078e-003, 
  3.202795982361e-003, 3.231763839722e-003, 3.258824348450e-003, 3.283739089966e-003, 3.306627273560e-003, 3.327250480652e-003, 3.345608711243e-003, 3.361582756042e-003, 
  3.375053405762e-003, 3.386020660400e-003, 3.394365310669e-003, 3.400087356567e-003, 3.402948379517e-003, 3.402948379517e-003, 3.399968147278e-003, 3.394126892090e-003, 
  3.385066986084e-003, 3.372788429260e-003, 3.357410430908e-003, 3.338575363159e-003, 3.316402435303e-003, 3.290772438049e-003, 3.261566162109e-003, 3.228783607483e-003, 
  3.192305564880e-003, 3.152132034302e-003, 3.108143806458e-003, 3.060221672058e-003, 3.008484840393e-003, 2.952694892883e-003, 2.892851829529e-003, 2.828836441040e-003, 
  2.760767936707e-003, 2.688407897949e-003, 2.611875534058e-003, 2.531051635742e-003, 2.445936203003e-003, 2.356290817261e-003, 2.262353897095e-003, 2.164006233215e-003, 
  2.061128616333e-003, 1.953721046448e-003, 1.841783523560e-003, 1.725435256958e-003, 1.604437828064e-003, 1.478791236877e-003, 1.348614692688e-003, 1.213908195496e-003, 
  1.074552536011e-003, 9.306669235229e-004, 7.822513580322e-004, 6.291866302490e-004, 4.715919494629e-004, 3.094673156738e-004, 1.428127288818e-004, -2.825260162354e-005, 
  -2.038478851318e-004, -3.838539123535e-004, -5.681514739990e-004, -7.567405700684e-004, -9.497404098511e-004, -1.146793365479e-003, -1.348137855530e-003, -1.553416252136e-003, 
  -1.762747764587e-003, -1.976013183594e-003, -2.193212509155e-003, -2.413988113403e-003, -2.638578414917e-003, -2.866744995117e-003, -3.098249435425e-003, -3.333210945129e-003, 
  -3.571391105652e-003, -3.812670707703e-003, -4.057049751282e-003, -4.304170608521e-003, -4.554152488708e-003, -4.806637763977e-003, -5.061507225037e-003, -5.318760871887e-003, 
  -5.578160285950e-003, -5.839586257935e-003, -6.102681159973e-003, -6.367564201355e-003, -6.633758544922e-003, -6.901383399963e-003, -7.169961929321e-003, -7.439494132996e-003, 
  -7.709741592407e-003, -7.980465888977e-003, -8.251547813416e-003, -8.522629737854e-003, -8.793592453003e-003, -9.064197540283e-003, -9.334206581116e-003, -9.603381156921e-003, 
  -9.871482849121e-003, -1.013827323914e-002, -1.040363311768e-002, -1.066720485687e-002, -1.092863082886e-002, -1.118779182434e-002, -1.144444942474e-002, -1.169836521149e-002, 
  -1.194918155670e-002, -1.219654083252e-002, -1.244032382965e-002, -1.268029212952e-002, -1.291608810425e-002, -1.314747333527e-002, -1.337409019470e-002, -1.359570026398e-002, 
  -1.381206512451e-002, -1.402282714844e-002, -1.422762870789e-002, -1.442646980286e-002, -1.461875438690e-002, -1.480436325073e-002, -1.498293876648e-002, -1.515412330627e-002, 
  -1.531779766083e-002, -1.547360420227e-002, -1.562118530273e-002, -1.576018333435e-002, -1.589059829712e-002, -1.601183414459e-002, -1.612377166748e-002, -1.622605323792e-002, 
  -1.631844043732e-002, -1.640069484711e-002, -1.647245883942e-002, -1.653349399567e-002, -1.658344268799e-002, -1.662218570709e-002, -1.664924621582e-002, -1.666462421417e-002, 
  -1.666784286499e-002, -1.665878295898e-002, -1.663720607758e-002, -1.660275459290e-002, -1.655519008636e-002, -1.649439334869e-002, -1.642012596130e-002, -1.633203029633e-002, 
  -1.623010635376e-002, -1.611399650574e-002, -1.598346233368e-002, -1.583838462830e-002, -1.567864418030e-002, -1.550388336182e-002, -1.531410217285e-002, -1.510906219482e-002, 
  -1.488864421844e-002, -1.465272903442e-002, -1.440119743347e-002, -1.413381099701e-002, -1.385045051575e-002, -1.355111598969e-002, -1.323580741882e-002, -1.290416717529e-002, 
  -1.255631446838e-002, -1.219213008881e-002, -1.181173324585e-002, -1.141476631165e-002, -1.100146770477e-002, -1.057171821594e-002, -1.012551784515e-002, -9.662985801697e-003, 
  -9.184002876282e-003, -8.688569068909e-003, -8.176922798157e-003, -7.649064064026e-003, -7.105112075806e-003, -6.544947624207e-003, -5.968928337097e-003, -5.377054214478e-003, 
  -4.769563674927e-003, -4.146456718445e-003, -3.507971763611e-003, -2.854228019714e-003, -2.185583114624e-003, -1.502037048340e-003, -8.040666580200e-004, -9.167194366455e-005, 
  6.347894668579e-004, 1.374959945679e-003, 2.128720283508e-003, 2.895712852478e-003, 3.675460815430e-003, 4.467964172363e-003, 5.272507667542e-003, 6.088972091675e-003, 
  6.916880607605e-003, 7.755875587463e-003, 8.605480194092e-003, 9.465336799622e-003, 1.033496856689e-002, 1.121401786804e-002, 1.210188865662e-002, 1.299810409546e-002, 
  1.390218734741e-002, 1.481354236603e-002, 1.573181152344e-002, 1.665639877319e-002, 1.758670806885e-002, 1.852202415466e-002, 1.946198940277e-002, 2.040588855743e-002, 
  2.135312557220e-002, 2.230298519135e-002, 2.325499057770e-002, 2.420830726624e-002, 2.516245841980e-002, 2.611660957336e-002, 2.707016468048e-002, 2.802228927612e-002, 
  2.897250652313e-002, 2.991986274719e-002, 3.086364269257e-002, 3.180325031281e-002, 3.273773193359e-002, 3.366649150848e-002, 3.458869457245e-002, 3.550350666046e-002, 
  3.641021251678e-002, 3.730797767639e-002, 3.819596767426e-002, 3.907334804535e-002, 3.993952274323e-002, 4.079329967499e-002, 4.163420200348e-002, 4.246115684509e-002, 
  4.327344894409e-002, 4.407012462616e-002, 4.485046863556e-002, 4.561352729797e-002, 4.635858535767e-002, 4.708468914032e-002, 4.779088497162e-002, 4.847657680511e-002, 
  4.914069175720e-002, 4.978251457214e-002, 5.040109157562e-002, 5.099558830261e-002, 5.156528949738e-002, 5.210924148560e-002, 5.262672901154e-002, 5.311679840088e-002, 
  5.357861518860e-002, 5.401146411896e-002, 5.441451072693e-002, 5.478692054749e-002, 5.512785911560e-002, 5.543661117554e-002, 5.571246147156e-002, 5.595457553864e-002, 
  5.616223812103e-002, 5.633461475372e-002, 5.647110939026e-002, 5.657088756561e-002, 5.663335323334e-002, 5.665779113770e-002, 5.664348602295e-002, 5.658996105194e-002, 
  5.649638175964e-002, 5.636215209961e-002, 5.618679523468e-002, 5.596971511841e-002, 5.571031570435e-002, 5.540812015533e-002, 5.506241321564e-002, 5.467295646667e-002, 
  5.423927307129e-002, 5.376064777374e-002, 5.323696136475e-002, 5.266773700714e-002, 5.205249786377e-002, 5.139100551605e-002, 5.068290233612e-002, 4.992783069611e-002, 
  4.912579059601e-002, 4.827618598938e-002, 4.737913608551e-002, 4.643428325653e-002, 4.544150829315e-002, 4.440081119537e-002, 4.331195354462e-002, 4.217505455017e-002, 
  4.098999500275e-002, 3.975677490234e-002, 3.847551345825e-002, 3.714621067047e-002, 3.576910495758e-002, 3.434419631958e-002, 3.287196159363e-002, 3.135228157043e-002, 
  2.978563308716e-002, 2.817225456238e-002, 2.651250362396e-002, 2.480685710907e-002, 2.305543422699e-002, 2.125895023346e-002, 1.941776275635e-002, 1.753258705139e-002, 
  1.560366153717e-002, 1.363182067871e-002, 1.161777973175e-002, 9.562015533447e-003, 7.465243339539e-003, 5.328416824341e-003, 3.152132034302e-003, 9.373426437378e-004, 
  -1.314997673035e-003, -3.604173660278e-003, -5.929112434387e-003, -8.288860321045e-003, -1.068234443665e-002, -1.310849189758e-002, -1.556622982025e-002, -1.805448532104e-002, 
  -2.057194709778e-002, -2.311730384827e-002, -2.568948268890e-002, -2.828717231750e-002, -3.090894222260e-002, -3.355348110199e-002, -3.621923923492e-002, -3.890502452850e-002, 
  -4.160916805267e-002, -4.433012008667e-002, -4.706645011902e-002, -4.981648921967e-002, -5.257868766785e-002, -5.535137653351e-002, -5.813276767731e-002, -6.092131137848e-002, 
  -6.371510028839e-002, -6.651234626770e-002, -6.931138038635e-002, -7.211041450500e-002, -7.490730285645e-002, -7.770037651062e-002, -8.048760890961e-002, -8.326709270477e-002, 
  -8.603680133820e-002, -8.879482746124e-002, -9.153902530670e-002, -9.426748752594e-002, -9.697806835175e-002, -9.966874122620e-002, -1.023372411728e-001, -1.049816608429e-001, 
  -1.075997352600e-001, -1.101893186569e-001, -1.127482652664e-001, -1.152743101120e-001, -1.177653074265e-001, -1.202191114426e-001, -1.226333379745e-001, -1.250058412552e-001, 
  -1.273344755173e-001, -1.296167373657e-001, -1.318507194519e-001, -1.340337991714e-001, -1.361639499664e-001, -1.382389068604e-001, -1.402562856674e-001, -1.422138214111e-001, 
  -1.441093683243e-001, -1.459405422211e-001, -1.477051973343e-001, -1.494009494781e-001, -1.510256528854e-001, -1.525770425797e-001, -1.540529727936e-001, -1.554510593414e-001, 
  -1.567692756653e-001, -1.580053567886e-001, -1.591570377350e-001, -1.602224111557e-001, -1.611990928650e-001, -1.620850563049e-001, -1.628781557083e-001, -1.635764837265e-001, 
  -1.641778945923e-001, -1.646802425385e-001, -1.650817394257e-001, -1.653802394867e-001, -1.655738353729e-001, -1.656607389450e-001, -1.656390428543e-001, -1.655068397522e-001, 
  -1.652623414993e-001, -1.649037599564e-001, -1.644293069839e-001, -1.638374328613e-001, -1.631264686584e-001, -1.622946262360e-001, -1.613405942917e-001, -1.602627038956e-001, 
  -1.590594053268e-001, -1.577293872833e-001, -1.562712192535e-001, -1.546835899353e-001, -1.529653072357e-001, -1.511149406433e-001, -1.491314172745e-001, -1.470135450363e-001, 
  -1.447603702545e-001, -1.423708200455e-001, -1.398439407349e-001, -1.371787786484e-001, -1.343744993210e-001, -1.314305067062e-001, -1.283458471298e-001, -1.251200437546e-001, 
  -1.217523813248e-001, -1.182423830032e-001, -1.145894527435e-001, -1.107934713364e-001, -1.068538427353e-001, -1.027704477310e-001, -9.854304790497e-002, -9.417140483856e-002, 
  -8.965563774109e-002, -8.499574661255e-002, -8.019161224365e-002, -7.524359226227e-002, -7.015168666840e-002, -6.491649150848e-002, -5.953812599182e-002, -5.401706695557e-002, 
  -4.835391044617e-002, -4.254913330078e-002, -3.660345077515e-002, -3.051745891571e-002, -2.429223060608e-002, -1.792836189270e-002, -1.142704486847e-002, -4.789113998413e-003, 
  1.984357833862e-003, 8.892059326172e-003, 1.593279838562e-002, 2.310526371002e-002, 3.040814399719e-002, 3.783988952637e-002, 4.539895057678e-002, 5.308377742767e-002, 
  6.089270114899e-002, 6.882393360138e-002, 7.687568664551e-002, 8.504593372345e-002, 9.333300590515e-002, 1.017345190048e-001, 1.102486848831e-001, 1.188731193542e-001, 
  1.276056766510e-001, 1.364439725876e-001, 1.453857421875e-001, 1.544284820557e-001, 1.635698080063e-001, 1.728069782257e-001, 1.821374893188e-001, 1.915585994720e-001, 
  2.010675668716e-001, 2.106616497040e-001, 2.203378677368e-001, 2.300933599472e-001, 2.399251461029e-001, 2.498301267624e-001, 2.598053216934e-001, 2.698475122452e-001, 
  2.799534797668e-001, 2.901201248169e-001, 3.003439903259e-001, 3.106218576431e-001, 3.209502696991e-001, 3.313258886337e-001, 3.417451381683e-001, 3.522044420242e-001, 
  3.627004623413e-001, 3.732295036316e-001, 3.837879896164e-001, 3.943721055984e-001, 4.049782752991e-001, 4.156029224396e-001, 4.262419939041e-001, 4.368919134140e-001, 
  4.475488662720e-001, 4.582089185715e-001, 4.688682556152e-001, 4.795230627060e-001, 4.901695251465e-001, 5.008034706116e-001, 5.114213228226e-001, 5.220187902451e-001, 
  5.325922966003e-001, 5.431375503540e-001, 5.536508560181e-001, 5.641280412674e-001, 5.745654106140e-001, 5.849586725235e-001, 5.953040122986e-001, 6.055976152420e-001, 
  6.158351898193e-001, 6.260131597519e-001, 6.361272335052e-001, 6.461738348007e-001, 6.561486721039e-001, 6.660481691360e-001, 6.758682727814e-001, 6.856050491333e-001, 
  6.952548027039e-001, 7.048137187958e-001, 7.142778635025e-001, 7.236436605453e-001, 7.329071760178e-001, 7.420648336411e-001, 7.511128187180e-001, 7.600476741791e-001, 
  7.688655853271e-001, 7.775632143021e-001, 7.861368656158e-001, 7.945832014084e-001, 8.028986454010e-001, 8.110798597336e-001, 8.191233873367e-001, 8.270262479782e-001, 
  8.347848653793e-001, 8.423961400986e-001, 8.498570919037e-001, 8.571645021439e-001, 8.643153905869e-001, 8.713066577911e-001, 8.781356811523e-001, 8.847993612289e-001, 
  8.912950754166e-001, 8.976200819016e-001, 9.037717580795e-001, 9.097476005554e-001, 9.155448675156e-001, 9.211614131927e-001, 9.265947341919e-001, 9.318424463272e-001, 
  9.369026422501e-001, 9.417729377747e-001, 9.464514255524e-001, 9.509360790253e-001, 9.552248716354e-001, 9.593162536621e-001, 9.632084369659e-001, 9.668995141983e-001, 
  9.703882932663e-001, 9.736729860306e-001, 9.767524003983e-001, 9.796252250671e-001, 9.822900295258e-001, 9.847459793091e-001, 9.869917631149e-001, 9.890266656876e-001, 
  9.908496141434e-001, 9.924600124359e-001, 9.938570261002e-001, 9.950400590897e-001, 9.960087537766e-001, 9.967626333237e-001, 9.973013401031e-001, 9.976246356964e-001, 
  9.977324008942e-001, 9.976246356964e-001, 9.973013401031e-001, 9.967626333237e-001, 9.960087537766e-001, 9.950400590897e-001, 9.938570261002e-001, 9.924600124359e-001, 
  9.908496141434e-001, 9.890266656876e-001, 9.869917631149e-001, 9.847459793091e-001, 9.822900295258e-001, 9.796252250671e-001, 9.767524003983e-001, 9.736729860306e-001, 
  9.703882932663e-001, 9.668995141983e-001, 9.632084369659e-001, 9.593162536621e-001, 9.552248716354e-001, 9.509360790253e-001, 9.464514255524e-001, 9.417729377747e-001, 
  9.369026422501e-001, 9.318424463272e-001, 9.265947341919e-001, 9.211614131927e-001, 9.155448675156e-001, 9.097476005554e-001, 9.037717580795e-001, 8.976200819016e-001, 
  8.912950754166e-001, 8.847993612289e-001, 8.781356811523e-001, 8.713066577911e-001, 8.643153905869e-001, 8.571645021439e-001, 8.498570919037e-001, 8.423961400986e-001, 
  8.347848653793e-001, 8.270262479782e-001, 8.191233873367e-001, 8.110798597336e-001, 8.028986454010e-001, 7.945832014084e-001, 7.861368656158e-001, 7.775632143021e-001, 
  7.688655853271e-001, 7.600476741791e-001, 7.511128187180e-001, 7.420648336411e-001, 7.329071760178e-001, 7.236436605453e-001, 7.142778635025e-001, 7.048137187958e-001, 
  6.952548027039e-001, 6.856050491333e-001, 6.758682727814e-001, 6.660481691360e-001, 6.561486721039e-001, 6.461738348007e-001, 6.361272335052e-001, 6.260131597519e-001, 
  6.158351898193e-001, 6.055976152420e-001, 5.953040122986e-001, 5.849586725235e-001, 5.745654106140e-001, 5.641280412674e-001, 5.536508560181e-001, 5.431375503540e-001, 
  5.325922966003e-001, 5.220187902451e-001, 5.114213228226e-001, 5.008034706116e-001, 4.901695251465e-001, 4.795230627060e-001, 4.688682556152e-001, 4.582089185715e-001, 
  4.475488662720e-001, 4.368919134140e-001, 4.262419939041e-001, 4.156029224396e-001, 4.049782752991e-001, 3.943721055984e-001, 3.837879896164e-001, 3.732295036316e-001, 
  3.627004623413e-001, 3.522044420242e-001, 3.417451381683e-001, 3.313258886337e-001, 3.209502696991e-001, 3.106218576431e-001, 3.003439903259e-001, 2.901201248169e-001, 
  2.799534797668e-001, 2.698475122452e-001, 2.598053216934e-001, 2.498301267624e-001, 2.399251461029e-001, 2.300933599472e-001, 2.203378677368e-001, 2.106616497040e-001, 
  2.010675668716e-001, 1.915585994720e-001, 1.821374893188e-001, 1.728069782257e-001, 1.635698080063e-001, 1.544284820557e-001, 1.453857421875e-001, 1.364439725876e-001, 
  1.276056766510e-001, 1.188731193542e-001, 1.102486848831e-001, 1.017345190048e-001, 9.333300590515e-002, 8.504593372345e-002, 7.687568664551e-002, 6.882393360138e-002, 
  6.089270114899e-002, 5.308377742767e-002, 4.539895057678e-002, 3.783988952637e-002, 3.040814399719e-002, 2.310526371002e-002, 1.593279838562e-002, 8.892059326172e-003, 
  1.984357833862e-003, -4.789113998413e-003, -1.142704486847e-002, -1.792836189270e-002, -2.429223060608e-002, -3.051745891571e-002, -3.660345077515e-002, -4.254913330078e-002, 
  -4.835391044617e-002, -5.401706695557e-002, -5.953812599182e-002, -6.491649150848e-002, -7.015168666840e-002, -7.524359226227e-002, -8.019161224365e-002, -8.499574661255e-002, 
  -8.965563774109e-002, -9.417140483856e-002, -9.854304790497e-002, -1.027704477310e-001, -1.068538427353e-001, -1.107934713364e-001, -1.145894527435e-001, -1.182423830032e-001, 
  -1.217523813248e-001, -1.251200437546e-001, -1.283458471298e-001, -1.314305067062e-001, -1.343744993210e-001, -1.371787786484e-001, -1.398439407349e-001, -1.423708200455e-001, 
  -1.447603702545e-001, -1.470135450363e-001, -1.491314172745e-001, -1.511149406433e-001, -1.529653072357e-001, -1.546835899353e-001, -1.562712192535e-001, -1.577293872833e-001, 
  -1.590594053268e-001, -1.602627038956e-001, -1.613405942917e-001, -1.622946262360e-001, -1.631264686584e-001, -1.638374328613e-001, -1.644293069839e-001, -1.649037599564e-001, 
  -1.652623414993e-001, -1.655068397522e-001, -1.656390428543e-001, -1.656607389450e-001, -1.655738353729e-001, -1.653802394867e-001, -1.650817394257e-001, -1.646802425385e-001, 
  -1.641778945923e-001, -1.635764837265e-001, -1.628781557083e-001, -1.620850563049e-001, -1.611990928650e-001, -1.602224111557e-001, -1.591570377350e-001, -1.580053567886e-001, 
  -1.567692756653e-001, -1.554510593414e-001, -1.540529727936e-001, -1.525770425797e-001, -1.510256528854e-001, -1.494009494781e-001, -1.477051973343e-001, -1.459405422211e-001, 
  -1.441093683243e-001, -1.422138214111e-001, -1.402562856674e-001, -1.382389068604e-001, -1.361639499664e-001, -1.340337991714e-001, -1.318507194519e-001, -1.296167373657e-001, 
  -1.273344755173e-001, -1.250058412552e-001, -1.226333379745e-001, -1.202191114426e-001, -1.177653074265e-001, -1.152743101120e-001, -1.127482652664e-001, -1.101893186569e-001, 
  -1.075997352600e-001, -1.049816608429e-001, -1.023372411728e-001, -9.966874122620e-002, -9.697806835175e-002, -9.426748752594e-002, -9.153902530670e-002, -8.879482746124e-002, 
  -8.603680133820e-002, -8.326709270477e-002, -8.048760890961e-002, -7.770037651062e-002, -7.490730285645e-002, -7.211041450500e-002, -6.931138038635e-002, -6.651234626770e-002, 
  -6.371510028839e-002, -6.092131137848e-002, -5.813276767731e-002, -5.535137653351e-002, -5.257868766785e-002, -4.981648921967e-002, -4.706645011902e-002, -4.433012008667e-002, 
  -4.160916805267e-002, -3.890502452850e-002, -3.621923923492e-002, -3.355348110199e-002, -3.090894222260e-002, -2.828717231750e-002, -2.568948268890e-002, -2.311730384827e-002, 
  -2.057194709778e-002, -1.805448532104e-002, -1.556622982025e-002, -1.310849189758e-002, -1.068234443665e-002, -8.288860321045e-003, -5.929112434387e-003, -3.604173660278e-003, 
  -1.314997673035e-003, 9.373426437378e-004, 3.152132034302e-003, 5.328416824341e-003, 7.465243339539e-003, 9.562015533447e-003, 1.161777973175e-002, 1.363182067871e-002, 
  1.560366153717e-002, 1.753258705139e-002, 1.941776275635e-002, 2.125895023346e-002, 2.305543422699e-002, 2.480685710907e-002, 2.651250362396e-002, 2.817225456238e-002, 
  2.978563308716e-002, 3.135228157043e-002, 3.287196159363e-002, 3.434419631958e-002, 3.576910495758e-002, 3.714621067047e-002, 3.847551345825e-002, 3.975677490234e-002, 
  4.098999500275e-002, 4.217505455017e-002, 4.331195354462e-002, 4.440081119537e-002, 4.544150829315e-002, 4.643428325653e-002, 4.737913608551e-002, 4.827618598938e-002, 
  4.912579059601e-002, 4.992783069611e-002, 5.068290233612e-002, 5.139100551605e-002, 5.205249786377e-002, 5.266773700714e-002, 5.323696136475e-002, 5.376064777374e-002, 
  5.423927307129e-002, 5.467295646667e-002, 5.506241321564e-002, 5.540812015533e-002, 5.571031570435e-002, 5.596971511841e-002, 5.618679523468e-002, 5.636215209961e-002, 
  5.649638175964e-002, 5.658996105194e-002, 5.664348602295e-002, 5.665779113770e-002, 5.663335323334e-002, 5.657088756561e-002, 5.647110939026e-002, 5.633461475372e-002, 
  5.616223812103e-002, 5.595457553864e-002, 5.571246147156e-002, 5.543661117554e-002, 5.512785911560e-002, 5.478692054749e-002, 5.441451072693e-002, 5.401146411896e-002, 
  5.357861518860e-002, 5.311679840088e-002, 5.262672901154e-002, 5.210924148560e-002, 5.156528949738e-002, 5.099558830261e-002, 5.040109157562e-002, 4.978251457214e-002, 
  4.914069175720e-002, 4.847657680511e-002, 4.779088497162e-002, 4.708468914032e-002, 4.635858535767e-002, 4.561352729797e-002, 4.485046863556e-002, 4.407012462616e-002, 
  4.327344894409e-002, 4.246115684509e-002, 4.163420200348e-002, 4.079329967499e-002, 3.993952274323e-002, 3.907334804535e-002, 3.819596767426e-002, 3.730797767639e-002, 
  3.641021251678e-002, 3.550350666046e-002, 3.458869457245e-002, 3.366649150848e-002, 3.273773193359e-002, 3.180325031281e-002, 3.086364269257e-002, 2.991986274719e-002, 
  2.897250652313e-002, 2.802228927612e-002, 2.707016468048e-002, 2.611660957336e-002, 2.516245841980e-002, 2.420830726624e-002, 2.325499057770e-002, 2.230298519135e-002, 
  2.135312557220e-002, 2.040588855743e-002, 1.946198940277e-002, 1.852202415466e-002, 1.758670806885e-002, 1.665639877319e-002, 1.573181152344e-002, 1.481354236603e-002, 
  1.390218734741e-002, 1.299810409546e-002, 1.210188865662e-002, 1.121401786804e-002, 1.033496856689e-002, 9.465336799622e-003, 8.605480194092e-003, 7.755875587463e-003, 
  6.916880607605e-003, 6.088972091675e-003, 5.272507667542e-003, 4.467964172363e-003, 3.675460815430e-003, 2.895712852478e-003, 2.128720283508e-003, 1.374959945679e-003, 
  6.347894668579e-004, -9.167194366455e-005, -8.040666580200e-004, -1.502037048340e-003, -2.185583114624e-003, -2.854228019714e-003, -3.507971763611e-003, -4.146456718445e-003, 
  -4.769563674927e-003, -5.377054214478e-003, -5.968928337097e-003, -6.544947624207e-003, -7.105112075806e-003, -7.649064064026e-003, -8.176922798157e-003, -8.688569068909e-003, 
  -9.184002876282e-003, -9.662985801697e-003, -1.012551784515e-002, -1.057171821594e-002, -1.100146770477e-002, -1.141476631165e-002, -1.181173324585e-002, -1.219213008881e-002, 
  -1.255631446838e-002, -1.290416717529e-002, -1.323580741882e-002, -1.355111598969e-002, -1.385045051575e-002, -1.413381099701e-002, -1.440119743347e-002, -1.465272903442e-002, 
  -1.488864421844e-002, -1.510906219482e-002, -1.531410217285e-002, -1.550388336182e-002, -1.567864418030e-002, -1.583838462830e-002, -1.598346233368e-002, -1.611399650574e-002, 
  -1.623010635376e-002, -1.633203029633e-002, -1.642012596130e-002, -1.649439334869e-002, -1.655519008636e-002, -1.660275459290e-002, -1.663720607758e-002, -1.665878295898e-002, 
  -1.666784286499e-002, -1.666462421417e-002, -1.664924621582e-002, -1.662218570709e-002, -1.658344268799e-002, -1.653349399567e-002, -1.647245883942e-002, -1.640069484711e-002, 
  -1.631844043732e-002, -1.622605323792e-002, -1.612377166748e-002, -1.601183414459e-002, -1.589059829712e-002, -1.576018333435e-002, -1.562118530273e-002, -1.547360420227e-002, 
  -1.531779766083e-002, -1.515412330627e-002, -1.498293876648e-002, -1.480436325073e-002, -1.461875438690e-002, -1.442646980286e-002, -1.422762870789e-002, -1.402282714844e-002, 
  -1.381206512451e-002, -1.359570026398e-002, -1.337409019470e-002, -1.314747333527e-002, -1.291608810425e-002, -1.268029212952e-002, -1.244032382965e-002, -1.219654083252e-002, 
  -1.194918155670e-002, -1.169836521149e-002, -1.144444942474e-002, -1.118779182434e-002, -1.092863082886e-002, -1.066720485687e-002, -1.040363311768e-002, -1.013827323914e-002, 
  -9.871482849121e-003, -9.603381156921e-003, -9.334206581116e-003, -9.064197540283e-003, -8.793592453003e-003, -8.522629737854e-003, -8.251547813416e-003, -7.980465888977e-003, 
  -7.709741592407e-003, -7.439494132996e-003, -7.169961929321e-003, -6.901383399963e-003, -6.633758544922e-003, -6.367564201355e-003, -6.102681159973e-003, -5.839586257935e-003, 
  -5.578160285950e-003, -5.318760871887e-003, -5.061507225037e-003, -4.806637763977e-003, -4.554152488708e-003, -4.304170608521e-003, -4.057049751282e-003, -3.812670707703e-003, 
  -3.571391105652e-003, -3.333210945129e-003, -3.098249435425e-003, -2.866744995117e-003, -2.638578414917e-003, -2.413988113403e-003, -2.193212509155e-003, -1.976013183594e-003, 
  -1.762747764587e-003, -1.553416252136e-003, -1.348137855530e-003, -1.146793365479e-003, -9.497404098511e-004, -7.567405700684e-004, -5.681514739990e-004, -3.838539123535e-004, 
  -2.038478851318e-004, -2.825260162354e-005, 1.428127288818e-004, 3.094673156738e-004, 4.715919494629e-004, 6.291866302490e-004, 7.822513580322e-004, 9.306669235229e-004, 
  1.074552536011e-003, 1.213908195496e-003, 1.348614692688e-003, 1.478791236877e-003, 1.604437828064e-003, 1.725435256958e-003, 1.841783523560e-003, 1.953721046448e-003, 
  2.061128616333e-003, 2.164006233215e-003, 2.262353897095e-003, 2.356290817261e-003, 2.445936203003e-003, 2.531051635742e-003, 2.611875534058e-003, 2.688407897949e-003, 
  2.760767936707e-003, 2.828836441040e-003, 2.892851829529e-003, 2.952694892883e-003, 3.008484840393e-003, 3.060221672058e-003, 3.108143806458e-003, 3.152132034302e-003, 
  3.192305564880e-003, 3.228783607483e-003, 3.261566162109e-003, 3.290772438049e-003, 3.316402435303e-003, 3.338575363159e-003, 3.357410430908e-003, 3.372788429260e-003, 
  3.385066986084e-003, 3.394126892090e-003, 3.399968147278e-003, 3.402948379517e-003, 3.402948379517e-003, 3.400087356567e-003, 3.394365310669e-003, 3.386020660400e-003, 
  3.375053405762e-003, 3.361582756042e-003, 3.345608711243e-003, 3.327250480652e-003, 3.306627273560e-003, 3.283739089966e-003, 3.258824348450e-003, 3.231763839722e-003, 
  3.202795982361e-003, 3.171801567078e-003, 3.139138221741e-003, 3.104686737061e-003, 3.068566322327e-003, 3.030896186829e-003, 2.991795539856e-003, 2.951145172119e-003, 
  2.909302711487e-003, 2.866148948669e-003, 2.821683883667e-003, 2.776265144348e-003, 2.729654312134e-003, 2.682209014893e-003, 2.633810043335e-003, 2.584576606750e-003, 
  2.534627914429e-003, 2.483844757080e-003, 2.432584762573e-003, 2.380728721619e-003, 2.328395843506e-003, 2.275586128235e-003, 2.222418785095e-003, 2.168893814087e-003, 
  2.115249633789e-003, 2.061247825623e-003, 2.007246017456e-003, 1.953125000000e-003, 1.899003982544e-003, 1.844763755798e-003, 1.790761947632e-003, 1.736760139465e-003, 
  1.682996749878e-003, 1.629471778870e-003, 1.576185226440e-003, 1.523137092590e-003, 1.470565795898e-003, 1.418232917786e-003, 1.366376876831e-003, 1.314997673035e-003, 
  1.264214515686e-003, 1.213788986206e-003, 1.164078712463e-003, 1.114845275879e-003, 1.066207885742e-003, 1.018285751343e-003, 9.710788726807e-004, 9.244680404663e-004, 
  8.786916732788e-004, 8.336305618286e-004, 7.892847061157e-004, 7.457733154297e-004, 7.030963897705e-004, 6.611347198486e-004, 6.201267242432e-004, 5.799531936646e-004, 
  5.406141281128e-004, 5.021095275879e-004, 4.645586013794e-004, 4.278421401978e-004, 3.920793533325e-004, 3.571510314941e-004, 3.231763839722e-004, 2.901554107666e-004, 
  2.580881118774e-004, 2.268552780151e-004, 1.965761184692e-004, 1.672506332397e-004, 1.388788223267e-004, 1.113414764404e-004, 8.475780487061e-005, 5.912780761719e-005, 
  3.433227539063e-005, 1.049041748047e-005, -1.239776611328e-005, -3.445148468018e-005, -5.555152893066e-005, -7.581710815430e-005, -9.524822235107e-005, -1.138448715210e-004, 
  -1.314878463745e-004, -1.484155654907e-004, -1.643896102905e-004, -1.796483993530e-004, -1.940727233887e-004, -2.076625823975e-004, -2.205371856689e-004, -2.325773239136e-004, 
  -2.439022064209e-004, -2.545118331909e-004, -2.644062042236e-004, -2.735853195190e-004, -2.821683883667e-004, -2.899169921875e-004, -2.970695495605e-004, -3.036260604858e-004, 
  -3.095865249634e-004, -3.148317337036e-004, -3.196001052856e-004, -3.236532211304e-004, -3.273487091064e-004, -3.303289413452e-004, -3.328323364258e-004, -3.348588943481e-004, 
  -3.364086151123e-004, -3.374814987183e-004, -3.380775451660e-004, -3.381967544556e-004, -3.379583358765e-004, -3.373622894287e-004, -3.362894058228e-004, -3.348588943481e-004, 
  -3.330707550049e-004, -3.310441970825e-004, -3.285408020020e-004, -3.257989883423e-004, -3.228187561035e-004, -3.196001052856e-004, -3.160238265991e-004, -3.122091293335e-004, 
  -3.081560134888e-004, -3.039836883545e-004, -2.994537353516e-004, -2.949237823486e-004, -2.900362014771e-004, -2.851486206055e-004, -2.800226211548e-004, -2.747774124146e-004, 
  -2.694129943848e-004, -2.640485763550e-004, -2.584457397461e-004, -2.528429031372e-004, -2.471208572388e-004, -2.412796020508e-004, -2.355575561523e-004, -2.295970916748e-004, 
  -2.237558364868e-004, -2.177953720093e-004, -2.118349075317e-004, -2.059936523438e-004, -2.000331878662e-004, -1.940727233887e-004, -1.882314682007e-004, -1.823902130127e-004, 
  -1.765489578247e-004, -1.707077026367e-004, -1.649856567383e-004, -1.592636108398e-004, -1.536607742310e-004, -1.480579376221e-004, -1.425743103027e-004, -1.372098922729e-004, 
  -1.318454742432e-004, -1.266002655029e-004, -1.214742660522e-004, -1.164674758911e-004, -1.114606857300e-004, -1.065731048584e-004, -1.018047332764e-004, -9.715557098389e-005, 
  -9.262561798096e-005, -8.821487426758e-005, -8.392333984375e-005, -7.975101470947e-005, -7.557868957520e-005, -7.164478302002e-005, -6.771087646484e-005, -6.401538848877e-005, 
  -6.043910980225e-005, -5.686283111572e-005, -5.352497100830e-005, -5.018711090088e-005, -4.708766937256e-005, -4.398822784424e-005, -4.112720489502e-005, -3.826618194580e-005, 
  -3.564357757568e-005, -3.302097320557e-005, -3.051757812500e-005, -2.825260162354e-005, -2.598762512207e-005, -2.384185791016e-005, -2.181529998779e-005, -1.990795135498e-005, 
  -1.800060272217e-005, -1.633167266846e-005, -1.466274261475e-005, -1.311302185059e-005, -1.168251037598e-005, -1.037120819092e-005, -9.059906005859e-006, -7.867813110352e-006, 
  -6.794929504395e-006, -5.841255187988e-006, -4.887580871582e-006, -4.053115844727e-006, -3.218650817871e-006, -2.503395080566e-006, -1.907348632813e-006, -1.311302185059e-006, 
  -7.152557373047e-007, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
  0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 0.000000000000e+000, 
};

/*--------------------------------------------------------------------------------*/
/** Return additional items in buffers required for delay to work
 */
/*--------------------------------------------------------------------------------*/
uint_t FractionalSampleAdditionalDelayRequired()
{
  return FilterTaps;
}

// one iteration of filter
#define FILTER_ITERATION                                                \
  res += filter[fpos] * buffer[bpos]; fpos += OversamplingRate; bpos += channels; if (bpos >= length) bpos -= length;

/*--------------------------------------------------------------------------------*/
/** Return the sample given by a floating point position within a buffer, assuming the buffer is circular
 *
 * @param buffer buffer containing channels x length samples
 * @param channel channel number read from
 * @param channels number of channels buffer contains (and therefore the step for each sample of the same channel)
 * @param length number of sample frames in the buffer
 * @param pos position
 *
 * @return interpolated sample at the desired position (offset by filter length)
 *
 * @note this function uses an SRC filter to allow 128 times over sampling of the position
 * @note it is equivalent to upsampling the audio by a factor of 128, find the integer position in the upsampled audio
 * @note and returning the sample from that position
 * 
 * @note in truth, it actually returns the sample from 7 (half of 14) positions BACK from the requested position because
 * @note it cannot assume that audio exists beyond the position requested and needs 14 valid samples for the filter,
 * @note it therefore assumes that there is at least 14 samples of valid historical samples available and moves the filter
 * @note back by 14 samples.  Since the peak filter value is in the centre of the filter, the result appears to be from 7 samples back
 *
 * @note because it uses a filter (of 14 taps), it is relatively CPU hungry 
 */
/*--------------------------------------------------------------------------------*/
double FractionalSample(const double *buffer, uint_t channel, uint_t channels, uint_t length, double pos)
{
  uint_t fpos = OversamplingRate - 1 - ((uint_t)((double)OversamplingRate * pos) % OversamplingRate); // set position in filter using fractional part of oversampling rate
  uint_t bpos = (uint_t)pos + length - FilterTaps;                                                    // set position in buffer to be the filter's length back from the requested position
  double res  = 0.0;

  // prepare parameters for unrolled loop
  buffer += channel;
  bpos   *= channels;
  length *= channels;
  bpos   %= length;

  // run over filter (MUST be FilterTaps copies)
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;

  return res;
}

double FractionalSample(const float *buffer, uint_t channel, uint_t channels, uint_t length, double pos)
{
  uint_t fpos = OversamplingRate - 1 - ((uint_t)((double)OversamplingRate * pos) % OversamplingRate); // set position in filter using fractional part of oversampling rate
  uint_t bpos = (uint_t)pos + length - FilterTaps;                                                    // set position in buffer to be the filter's length back from the requested position
  double res  = 0.0;

  // prepare parameters for unrolled loop
  buffer += channel;
  bpos   *= channels;
  length *= channels;
  bpos   %= length;

  // run over filter (MUST be FilterTaps copies)
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;
  FILTER_ITERATION;

  return res;
}

BBC_AUDIOTOOLBOX_END
